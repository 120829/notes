# （三）数据链路层

## 1. 数据链路层概述

### 1.1 数据链路层在网络体系结构中的地位

数据链路层上传输的数据包称为帧。

![3-1](https://cdn.jsdelivr.net/gh/Hacker-C/Picture-Bed@main/C-Network/3-1.5ea3zzg868g0.png)

### 1.2 使用点对点信道的数据链路层

> 数据链路层的三个重要问题

#### 1. 封装成帧 

**封装成帧**：数据链路层给网络层交付的协议数据单元添加 **帧头和帧尾** 的操作。称为封装成帧。  
**目的**：为了在链路上 **以帧为单元** 来传送数据，也就是 **为了实现数据链路层本身的功能。**

![3-2](https://cdn.jsdelivr.net/gh/Hacker-C/Picture-Bed@main/C-Network/3-2.vvt6v0jxdpc.png)

#### 2. 差错检测

接收方主机收到帧后，通过检错码和检错算法，就可以判断出帧在传输过程中是否出现了了误码。

![3-3](https://cdn.jsdelivr.net/gh/Hacker-C/Picture-Bed@main/C-Network/3-3.6soswamch480.png)

#### 3. 可靠传输

接受方主机收到有误码的帧后，不会接受，将其丢弃。  
如果数据链路层向其上层提供的是不可靠服务，丢弃就丢弃了，不会有更多措施。  
如果数据链路层向其上层提供的是 **可靠服务**，就还需要其他措施，确保接收方主机回以重新收到被丢弃的这个帧的确副本。

![3-4](https://cdn.jsdelivr.net/gh/Hacker-C/Picture-Bed@main/C-Network/3-4.5nykph0hbik0.png)

> 以上都是使用 **点对点** 信道的数据链路层来举例的。

### 1.3 使用广播信道的数据链路层

- 共享式以太网的媒体接入控制协议CSMA/CD
- 802.11局域网的媒体接入控制协议CSMA/CA

![3-6](https://cdn.jsdelivr.net/gh/Hacker-C/Picture-Bed@main/C-Network/3-6.240tmjjr18jk.png)

### 1.4 数据链路层的互联设备

- 网桥和交换机的工作原理
- 集线器（物理层互连设备)与交换机的区别

![3-5](https://cdn.jsdelivr.net/gh/Hacker-C/Picture-Bed@main/C-Network/3-5.1k0uqz9x8dz4.png)

## 2. 封装成帧

### 2.1 封装成帧

封装成帧是指数据链路层给上层交付的协议数据单元添加帧头和帧尾使之成为帧。
- 帧头和帧尾中包含有重要的控制信息。
- 帧头和帧尾的作用之一就是帧定界。

1）PPP帧的帧头和帧尾各有一个标志字节，作用是帧定界。

![3-9](https://cdn.jsdelivr.net/gh/Hacker-C/Picture-Bed@main/C-Network/3-9.156vth7bfmao.png)

2）**并不是每一种数据链路层协议的帧都包含帧定界标志。** 例如，以太网MAC帧。而且以太网V2的MAC帧还有帧间间隔，规定为 96 比特时间。

![3-10](https://cdn.jsdelivr.net/gh/Hacker-C/Picture-Bed@main/C-Network/3-10.7iclb7mbp4c0.png)

### 2.2 透明传输

**透明传输**：是指数据链路层对上层交付的传输数据没有任何限制，就好像数据链路层不存在一样。

![3-7](https://cdn.jsdelivr.net/gh/Hacker-C/Picture-Bed@main/C-Network/3-7.g2e5zs24zs8.png)

**例题**

![3-11](https://cdn.jsdelivr.net/gh/Hacker-C/Picture-Bed@main/C-Network/3-11.3u07pmbp2fc0.png)

### 2.3 提高帧传输效率

![3-8](https://cdn.jsdelivr.net/gh/Hacker-C/Picture-Bed@main/C-Network/3-8.652gtybl8vo0.png)

## 3. 差错检测

### 3.1 概念

- **比特差错**：实际的通信链路都不是理想的，比特在传输过程中可能会产生差错: 1可能会变成0,而0也可能变成1。这称为比特差错。
- **误码率BER**：在一段时间内，传输错误的比特占所传输比特总数的比率称为误码率BER(Bit Error Rate)
- **差错检测码FCS**：使用差错检测码来检测数据在传输过程中是否产生了比特差错，是数据链路层所要解决的重要问题之一。


![3-12](https://cdn.jsdelivr.net/gh/Hacker-C/Picture-Bed@main/C-Network/3-12.2jhqh0ugkrs0.png)

### 3.2 奇偶校验

- **奇/偶校验**：在待发送的数据后面 **添加1位奇偶校验位**，使整个数据（包括所添加的校验位在内)中 **“1”的个数** 为奇数(奇校验)或偶数（偶校验)。
- 如果有 **奇数个位发生误码**，则奇偶性发生变化，**可以检查出误码**
- 如果有 **偶数个位发生误码**，则奇偶性不发生变化，**不能检查出误码（漏检)**

![3-13](https://cdn.jsdelivr.net/gh/Hacker-C/Picture-Bed@main/C-Network/3-13.3075ixh62600.png)

> 奇偶校验法的漏检率较高，数据链路层一般不采用这种方法。

### 3.3 循环冗余检验

#### 1. 循环冗余检验:CRC(Cyclic Redundancy Check)

**1）CRC**

![3-17](https://cdn.jsdelivr.net/gh/Hacker-C/Picture-Bed@main/C-Network/3-17.35cd446mr900.png)

**2）生成多项式**

![3-18](https://cdn.jsdelivr.net/gh/Hacker-C/Picture-Bed@main/C-Network/3-18.2nsiqx5fa7o0.png)

#### 2. 举例

**1）发送方处理**

![3-14](https://cdn.jsdelivr.net/gh/Hacker-C/Picture-Bed@main/C-Network/3-14.2zqhaxf0kag.png)

**2）接收方处理**

![3-15](https://cdn.jsdelivr.net/gh/Hacker-C/Picture-Bed@main/C-Network/3-15.wl7q2nrrjo0.png)

### 3.4 本节总结

![3-16](https://cdn.jsdelivr.net/gh/Hacker-C/Picture-Bed@main/C-Network/3-16.1fgm6l28lvpc.png)