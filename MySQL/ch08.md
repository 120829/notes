# （八）视图

## 1. 视图的概念

视图：MySQL从5.0.1版本开始提供视图功能。是 **一种虚拟存在的表**，行和列的数据来自定义视图的查询中使用的表，并且是在使用视图时 **动态生成** 的，**只保存了sql逻辑，不保存查询结果**。  

应用场景:
- 多个地方用到 **同样的查询结果**
- 该查询结果 **使用的sql语句较复杂**

案例1：查询姓张的学生的名字和专业名
1. 不使用视图：
```sql
SELECT studentname,majorname
FROM student s
INNER JOIN major m
ON s.majorid=m.majorid
WHERE studentname LIKE '张%';
```

2. 使用视图：

```sql
CREATE VIEW v1
AS
SELECT studentname,majorname
FROM student s
INNER JOIN major m
ON s.majorid=m.majorid;

SELECT * FROM v1
WHERE studentname LIKE '张%';
```

## 2. 创建视图

语法：

```sql
CREATE VIEW 视图名
AS
查询语句;
```

案例1：查询邮箱中包含a字符的员工名、部门名和工种信息

```sql
CREATE VIEW myv1
AS
SELECT last_name,department_name,job_title
FROM employees e
INNER JOIN departments d
ON e.department_id=d.department_id
INNER JOIN jobs j
ON j.job_id=e.job_id;
```

案例2：查询各部门的平均工资级别

```sql
CREATE VIEW myv2
AS
SELECT AVG(salary) avg,department_id
FROM employees
GROUP BY department_id;

SELECT myv2.avg,g.grade_level
FROM myv2
INNER JOIN job_grades g
ON myv2.avg BETWEEN g.lowest_sal AND g.highest_sal;
```

案例3：查询平均工资最低的部门门信息

```sql
SELECT * FROM myv2
ORDER BY avg ASC
LIMIT 1;
```

案例4：查询平均工资最低的部门名和工资

```sql
CREATE VIEW myv3
AS
SELECT * FROM myv2
ORDER BY avg ASC
LIMIT 1;

SELECT d.*,m.AVG
FROM myv3 m
JOIN departments d
ON m.department_id=d.department_id;
```

## 3. 视图的优点

- 重用sql语句
- 简化复杂的sql操作，不必知道查询细节
- 保护数据，提高安全性