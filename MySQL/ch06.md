# （六）连接查询

含义：连接查询又称为多表查询，当查询的字段来自多个表时，就会用到连接查询。

## 1. 笛卡尔乘积

笛卡尔乘积现象：表1有 `m` 行，表2有 `n` 行，则查询结果有 `m*n` 行。

```sql
SELECT `name`, boyName FROM boys, beauty;
```

发生原因：没有有效的连接条件  
解决办法：添加有效的连接条件  

```sql
SELECT `name`, boyName FROM boys, beauty
WHERE beauty.boyfriend_id=boys.id;
```

## 2. 连接查询分类

### 2.1 按年代分

1. sql192 标准【只支持内连接】
2. sql199 标准【推荐】支持内连接+外连接（左外和内外）+交叉连接

### 2.2 按功能分

![](https://z3.ax1x.com/2021/04/17/c4lurD.png)

## 3. 等值连接

### 3.1 特点

1. 多表等值连接的结果为多表的交集部分
2. n表连接，至少需要n-1个连接条件
3. 多表的顺序没有要求
4. 一般需要为表取别名
5. 连接可以搭配前面所有子句使用，比如排序、分组、筛选

### 3.2 一般使用

案例1: 查询女神名和对应的男神名

```sql
USE girls;
SELECT `name`, boyName
FROM boys, beauty
WHERE beauty.boyfriend_id=boys.id;
```

案例2：查询员工名和对应的部门名
```sql
USE myemployees;
SELECT last_name, department_name
FROM employees,departments
WHERE employees.department_id=departments.department_id;
```
### 3.3 为表取别名

优点：提高简洁度、区分重名字段
注意：如果为表起了别名，则查询的字段就不能使用原来的表名去限定

案例2：查询员工名、工种号、工种名
```sql
SELECT e.last_name,e.job_id,j.job_title
FROM jobs AS j， employees AS e
WHERE e.job_id=j.job_id;
```
### 3.4 两表顺序可以调换
```sql
SELECT e.last_name,e.job_id,j.job_title
FROM employees e,jobs j
WHERE e.job_id=j.job_id;
```
### 3.5 可以加筛选

案例1: 查询有奖金的员工名、部门名
```sql
SELECT last_name,department_name,commission_pct
FROM employees e, departments d
WHERE e.department_id=d.department_id
AND e.commission_pct IS NOT NULL;
```
案例2：查询城市名中第二个字符为o的部门名和城市名
```sql
SELECT department_name,city
FROM departments d, locations l
WHERE d.location_id=l.location_id
AND city LIKE '_o%';
```
### 3.6 可以加分组

案例1：查询每个城市的部门个数
```sql
SELECT COUNT(*) 个数,city
FROM departments d,locations l
WHERE d.location_id=l.location_id
GROUP BY city;
```
案例2：查询有奖金的每个部门的部门名和部门的领导编号和该部门的最低工资
```sql
SELECT department_name, d.manager_id,MIN(salary)
FROM departments d, employees e
WHERE d.department_id=e.department_id
AND commission_pct IS NOT NULL
GROUP BY department_name,d.manager_id;
```
### 3.7 可以加排序

案例：查询每个工种的工种名和员工的个数，并且按员工个数降序
```sql
SELECT job_title,COUNT(*)
FROM employees e,jobs j
WHERE e.job_id=j.job_id
GROUP BY job_title
ORDER BY COUNT(*) DESC;
```
### 3.8 可以实现三表连接

案例：查询员工名、部门名和所在城市
```sql
SELECT last_name,department_name,city
FROM employees e,departments d,locations l
WHERE e.department_id=d.department_id
AND d.location_id=l.location_id
AND city LIKE 's%'
ORDER BY department_name DESC;
```
## 4. 非等值连接

案例1：查询员工工资和工资级别
```sql
SELECT salary, grade_level
FROM employees e,job_grades g
WHERE salary BETWEEN g.lowest_sal AND g.highest_sal
AND g.grade_level='A';
```